# IncClocks
**Плагин на цифровые часы из блоков для конкурса плагинов от _BeBr0_**
- **Версия:** _1.20_
- **Автор:** _Jone501_

## Информация
**IncClocks** - это плагин, добавляющий цифровые часы, таймеры и секундомеры, которые можно легко настроить под свои нужды! Вы можете использовать любые шрифты, форматирование, настройки размера символов и т.д., чтобы разнообразить текст на часах, а также можете настроить корпус часов начиная с материалов, из которого он состоит, и заканчивая внутренним отступом и скруглением краёв!!!

## Структура
При запуске, плагин создаёт папку `plugins/IncClocks`, в которой будут находиться все файлы плагина. Эта папка содержит:

- Папку `fonts`, в которой будут находиться доступные шрифты формата _**.ttf**_
- Папку `clocks`, в которой будут находиться конфиги с настройками часов
- Папку `stopwatches`, в которой будут находиться конфиги с настройками секундомеров
- Папку `timers`, в которой будут находиться конфиги с настройками таймеров
- Папку `actions`, в которой будут находиться кастомные скрипты действий, совершаемых при остановке таймеров

Все эти папки, а так же их содержимое будет подробнее рассмотренно ниже

## Шрифты
Плагин может отображать текст с абсолютно любым шрифтом формата _**.ttf**_. Чтобы использовать свой шрифт, его нужно переместить в папку `fonts`, после чего его можно будет указать в настройках часов, таймеров и секундомеров, указав в параметре `text.font` название файла шрифта (без расширения _.ttf_)

## Часы
В папке `clocks` вы можете создавать шаблоны часов. Позднее вы сможете по этим шаблонам создавать часы в любой точке своего мира используя команду [_**incclocks place clocks <название>**_](#incclocks-place-clockstimerstopwatch-название)

### Конфиг
```yaml
time-type: REAL # REAL - реальное время | GAME - игровое время
time-zone: 0 # часовой пояс относительно локального времени сервера (только в режиме REAL)

# %h - часы
# %m - минуты
# %s - секунды (только в режиме REAL)
# ${block} - изменить материал следующих символов
format: '${LIME_CONCRETE}%h:%m' # текст, выводимый на дисплей

# настройки текста
text:
  offset: 0 # общий сдвиг текста
  # или
  offset:
    x: 0 # горизонтальный сдвиг текста
    y: 0 # вертикальный сдвиг текста
  font: Nunito # шрифт
  text-size: 16 # размер текста
  letter-spacing: -8 # межсимвольный интервал

# настройки материалов
materials:
  back: BLACK_CONCRETE # блок заднего фона текста
  sides: GRAY_CONCRETE # блок стенок корпуса

# настройки формы
form:
  padding: 0 # общий внутренний отступ
  # или
  padding:
    horizontal: 0 # горизонтальный внутренний отступ
    vertical: 0 # вертикальный внутренний отступ
  border-radius: 5 # скругление углов
  width: 5 # ширина
```
### Взаимодействие
_Доступно только игрокам с привелегией **incclocks.admin**_

При клике по часам левой кнопкой мыши открывается меню, в котором вы можете удалить часы

## Секундомер
В папке `stopwatches` вы можете создавать шаблоны секундомеров. Позднее вы сможете по этим шаблонам создавать секундомеры в любой точке своего мира используя команду [_**incclocks place stopwatch <название>**_](#incclocks-place-clockstimerstopwatch-название)

### Конфиг
```yaml
time-type: REAL # REAL - реальное время | GAME - игровое время

# %d - дни
# %h - часы
# %m - минуты
# %s - секунды (только в режиме REAL)
# ${block} - изменить материал следующих символов
format: '${LIME_CONCRETE}%h:%m' # текст, выводимый на дисплей

# настройки текста
text:
  offset: 0 # общий сдвиг текста
  # или
  offset:
    x: 0 # горизонтальный сдвиг текста
    y: 0 # вертикальный сдвиг текста
  font: Nunito # шрифт
  text-size: 16 # размер текста
  letter-spacing: -8 # межсимвольный интервал

# настройки материалов
materials:
  back: BLACK_CONCRETE # блок заднего фона текста
  sides: GRAY_CONCRETE # блок стенок корпуса

# настройки формы
form:
  padding: 0 # общий внутренний отступ
  # или
  padding:
    horizontal: 0 # горизонтальный внутренний отступ
    vertical: 0 # вертикальный внутренний отступ
  border-radius: 5 # скругление углов
  width: 5 # ширина
```
### Взаимодействие
_Доступно только игрокам с привелегией **incclocks.admin**_

При клике по секундомеру левой кнопкой мыши открывается меню, в котором вы можете запустить, остановить или удалить секундомер

## Таймер
В папке `timers` вы можете создавать шаблоны таймеров. Позднее вы сможете по этим шаблонам создавать таймеры в любой точке своего мира используя команду [_**incclocks place timer <название>**_](#incclocks-place-clockstimerstopwatch-название)

### Конфиг
```yaml
time-type: REAL # REAL - реальное время | GAME - игровое время

# %d - дни
# %h - часы
# %m - минуты
# %s - секунды (только в режиме REAL)
# ${block} - изменить материал следующих символов
format: '${LIME_CONCRETE}%h:%m' # текст, выводимый на дисплей
actions: [] # действия, выполняемые при остановке таймера (см. Действия)

# формат: 1d|2h|...|10m
# xd - x дней
# xh - x часов
# xm - x минут
# xs - x секунд (только в режиме REAL)
time: 1h # время таймера

# настройки текста
text:
  offset: 0 # общий сдвиг текста
  # или
  offset:
    x: 0 # горизонтальный сдвиг текста
    y: 0 # вертикальный сдвиг текста
  font: Nunito # шрифт
  text-size: 16 # размер текста
  letter-spacing: -8 # межсимвольный интервал

# настройки материалов
materials:
  back: BLACK_CONCRETE # блок заднего фона текста
  sides: GRAY_CONCRETE # блок стенок корпуса

# настройки формы
form:
  padding: 0 # общий внутренний отступ
  # или
  padding:
    horizontal: 0 # горизонтальный внутренний отступ
    vertical: 0 # вертикальный внутренний отступ
  border-radius: 5 # скругление углов
  width: 5 # ширина
```
### Взаимодействие
_Доступно только игрокам с привелегией **incclocks.admin**_

При клике по таймеру левой кнопкой мыши открывается меню, в котором вы можете запустить, сбросить или удалить таймер

## Команды
_Команды доступны только игрокам с привелегией **incclocks.admin**_
### incclocks help
**_Помощь по командам_**
### incclocks reload
**_Перезагрузка плагина и обновление часов, таймеров и секундомеров_**
### incclocks place <clocks|timer|stopwatch> <название>
**_Установка часов/таймера/секундомера по шаблону `название.yml`_**

При вводе команды у вас появится предпросмотр будущего положения объекта, отображаемый при помощи частиц. Установить часы можно только если на месте будущих часов не находятся блоки. Если установка невозможна из-за мешающих блоков, то частицы будут красные. В противном случае они будут зелёными.

Устанавливать объект можно только на твёрдые блоки и только в радиусе 100 блоков, в противном случае предпросмотр не будет отображаться, а установка будет невозможна. Пока идёт установка, вы не можете ломать, ставить и вообще как либо взаимодействовать с блоками

- Чтобы отменить установку, нужно нацелиться на нетвёрдый блок (или в небо) или на блок, находящийся дальше 100 блоков и нажать **ЛКМ**
- Если нажать **ЛКМ**, будучи наведённым на блок в радиусе 100 блоков, то можно поворачивать объект на 90 градусов против часовой стрелки (Только в горизонтальной плоскости! В противном случае поворот не окажет никакого эффекта).
- Если нажать **ЛКМ + SHIFT** и территория не будет содержать мешающих блоков (частицы должны быть зелёными), то установка будет завершена, а объект будет размещён в мире. В противном случае процесс установки продолжится
- Если во время установки игрок отключится от сервера, процесс установки будет отменён

# Действия
**Действие** - это определённый процесс, выполняемый при остановке таймера. Действия могут быть использованы только в настройке таймеров в параметре `actions`. Действия задаются строкой определёного формата, которая используется для указания действия, его поведения и аргументов. Формат данной строки следующий:

`[действие(настройки)] аргумент`

### действие
Это обязательный элемент. Он обозначает то, какое действие будет совершено

Список всех встроенных действий, а так же способ создания своих собственных действий будут описаны далее

### аргумент
Это элемент, наличие и формат которого зависит от действия. Каким-то действиям необходимы аргументы, каким-то нет

### настройки
Это необязательный элемент. Он позволяет настроить выполнение действия

Если вы не хотите настраивать действие, то можете не писать круглые скобки. В таком случае строка будет иметь такой формат: `[действие] аргумент`

Настройки имеют формат `параметр=значение` и указываются через `;`

Пример: `[action(a=1;pi=3.14;...;m=HELLO)] argument`

Однако несмотря на пример с большим количеством разных параметров, у всех действий есть только 3 настройки:

#### delay
- Использование: `delay`, `del` или `d`
- Тип значения: **TimeMetric**
```
TimeMetric - это строка с форматом <число>[tick|t|sec|s|min|m|hour|h],
которая позволяет удобно задавать временные значения.

Пример:
- 10tick или 10t - 10 тиков
- 10sec или 10s - 10 секунд
- 10min или 10m - 10 минут
- 10hour или 10h - 10 часов
```
- Значение по умолчанию: `0t`

  Задаёт задержку перед выполнением действия

#### period
- Использование: `period`, `per` или `p`
- Тип значения: **TimeMetric**
- Значение по умолчанию: `0t`

  Задаёт период с которым выполняется действие

#### repeats
- Использование: `repeats`, `rep` или `r`
- Тип значения: **Integer**
- Значение по умолчанию: `1`

  Задаёт количество повторений действия

### Встроенные действия

- **message**

  Отправляет сообщение в чат всем игрокам

  _Аргумент:_ `<сообщение>`
---
- **command**

  Выполняет команду

  _Аргумент:_ `<команда>`
---
- **destroy**

  Уничтожает таймер

  _Аргумент: Не требуется_

### Кастомные действия

Выше мы упоминали возможность создавать собственные действия. В этом разделе будет подробно описана эта возможность

#### Nashorn

_Nashorn_ — это движок, способный выполнять код на языке _JavaScript_, а также использовать в коде классы и методы языка _Java_

Благодаря ему можно создавать модули для Java программ, которыми, в нашем случае, и являются кастомные действия

#### Создание скрипта

При запуске плагин создаёт папку `actions`. В этой папке будут находиться скрипты кастомных действий, написанные на языке JavaScript и имеющие расширение _.js_

Давайте создадим наш первый скрипт!

Мы будем создавать простой скрипт, который поджигает всех игроков в мире, в котором находится таймер, на количество тиков, указанное в аргументе. Мы назовём это действие `fire`

Теперь в папке `actions` создаеём файл `fire.js` (название действия зависит от названия файла). Теперь мы можем использовать это действие в параметре `actions`:
```yaml
actions:
  - '[fire]'
```
Однако пока что это действие ничего не делает. Пора это исправить!

Мы хотим сделать так, чтобы игрок поджигался на определённое количество тиков, которое мы сможем указывать в аргументе. При выполнении кастомного действия в движок **_Nashorn_** передаются следующие данные:

- **BossAction**

  `arg` - Аргумент действия.

  `boss` - Объект, в котором находится информация о боссе, и через который можно управлять боссом. _(см. описание класса [**Boss**](https://github.com/IncrementStudio/IncBossesAbilitiesAPI?tab=readme-ov-file#boss) в **IncBossesAbilitiesAPI**)_

- **PlayerAction**

  `arg` - Аргумент действия.

  `boss` - Объект, в котором находится информация о боссе, и через который можно управлять боссом.

  `player` - Игрок, над которым совершается действие.

Мы хотим проверить, указан ли аргумент, и если указан, то конвертировать строку аргумента в целое число и передать его в метод _**setFireTicks**_, который вызывается для объекта `player`

Тогда наш скрипт будет выглядеть так:

```js
if (arg != null) {
	time = parseInt(arg);
	player.setFireTicks(time);
}
```

Теперь мы можем настроить способность так, чтобы при старте фазы, всех игроков в радиусе 5 блоков поджигало на 5 секунд:
```yaml
abilities:
  actions:
    ability: IncBossesAbility_Actions
    start-players-actions-radius: 5
    start-players-actions:
      - '[fire] 100'
```

Таким образом можно создавать абсолютно любые действия, имея даже небольшие знания **_Nashorn_**, **_JS_** и _**Java**!_

Статьи, которые могут помочь вам в изучении _**Nashorn**_:
- [Введение в Nashorn](https://habr.com/ru/articles/195870/) _(Русский)_
- [Introduction to Nashorn](https://www.baeldung.com/java-nashorn) _(Английский)_